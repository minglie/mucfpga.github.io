<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.bootcss.com/react/16.4.0/umd/react.development.js"></script>
    <script src="https://cdn.bootcss.com/react-dom/16.4.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.bootcss.com/babel-standalone/6.26.0/babel.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://minglie.github.io/js/M_mock.js"></script>
    <script src="js/reactTest.js"></script>

</head>

<body>

<div id="example" class="example"></div>


<script type="text/babel">

    class TodoItem extends React.Component {
        constructor(props){
            super(props);
        }

        handleDelete(id){
            this.props.delete(id)
        }

        render() {
            const {content}= this.props;
            const r= content.map((u,index)=>{
                    return(
                        <li key={u.id}>
                            {u.id} {u.name}   {u.age}
                            <button onClick={this.handleDelete.bind(this,u.id)}>删除</button>

                        </li>
                    )
                }
            )
            return (
                <div>{r}</div>
            )
        }
    }



    var M_this={};
    class TodoList extends React.Component {
        // 初始化数据
        constructor(props){
            super(props);
            this.state={
                list:[],
            }

            M_this=this;
        }

        componentDidMount() {

            $.ajax({
                url:'/listAll',
                type:'get',
                dataType:'json',
                success:function(data){
                    console.log(data.data)
                    M_this.setState({
                        list:data.data
                    });

                }
            });
        };

        getTodoItems(){
            return(
                78
            )
        }

        handleAdd(e) {

            $.ajax({
                url:'/add',
                type:"post",
                data:{
                    name:this.refs.name.value,
                    age:this.refs.age.value,
                },
                success:function(data){
                    console.log(data.data)
                }
            });
            $.ajax({
                url:'/listAll',
                type:'get',
                dataType:'json',
                success:function(data){
                    console.log(data.data)
                    M_this.setState({
                        list:data.data
                    });

                }
            });
        }

        handleUpdate(e) {
            $.ajax({
                url:'/update',
                type:"post",
                data:{
                    id:this.refs.id.value,
                    name:this.refs.name.value,
                    age:this.refs.age.value,
                },
                success:function(data){
                    console.log(data.data)
                }
            });
            $.ajax({
                url:'/listAll',
                type:'get',
                dataType:'json',
                success:function(data){
                    console.log(data.data)
                    M_this.setState({
                        list:data.data
                    });

                }
            });
        }


        handledelete(e) {
            console.log(e+"AAAAAAAAAAAAAAAAAA")
            $.ajax({
                url:'/delete?id='+e,
                type:'get',
                dataType:'json',
                success:function(data){
                    console.log(data.data)
                }
            });

            $.ajax({
                url:'/listAll',
                type:'get',
                dataType:'json',
                success:function(data){
                    console.log(data.data)
                    M_this.setState({
                        list:data.data
                    });

                }
            });



        }

        render() {
            return (
                <div>
                    <input type="text" ref="id" id="id" placeholder="id" autoComplete="off"/>
                    <input type="text" ref="name" id="name" placeholder="name" autoComplete="off"/>
                    <input type="text" ref="age" id="age" placeholder="age" autoComplete="off"/>
                    <button onClick={this.handleAdd.bind(this)}>添加</button>
                    <button onClick={this.handleUpdate.bind(this)}>修改</button>
                    <TodoItem content={this.state.list} delete={this.handledelete}/>
                </div>
            );
        }
    }




    ReactDOM.render(
        <div>
            <TodoList />
        </div>,
        document.getElementById('example')
    );
</script>



</body>
</html>